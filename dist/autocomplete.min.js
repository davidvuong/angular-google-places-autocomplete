/**
 * ng-gplaces-autocomplete - v0.2.7, 2015-07-08 12:57:37 PM
 * https://github.com/davidvuong/ng-gplaces-autocomplete
 *
 * Copyright (c) 2015 David Vuong <david.vuong256@gmail.com>
 * Licensed MIT <https://raw.githubusercontent.com/davidvuong/ng-gplaces-autocomplete/master/LICENSE>
 */
!function(){"use strict";function a(a){if(!a.google)throw"Global `google` var missing. Did you forget to include the places API script?";return a.google}angular.module("google.places.directives",[]),angular.module("google.places.filters",[]);var b=angular.module("google.places",["google.places.directives","google.places.filters"]);a.$inject=["$window"],b.factory("google",a)}(),function(a){"use strict";function b(a,b,c){return{restrict:"A",require:"^ngModel",scope:{model:"=ngModel",options:"=?",forceSelection:"=?",customPlaces:"=?"},controller:["$scope",function(a){}],link:function(d,e,f,g){function h(){e.bind("keydown",k),e.bind("blur",l),e.bind("submit",l),d.$watch("selected",m)}function i(){var b=angular.element("<div g-places-autocomplete-drawer></div>");b.attr({input:"input",query:"query",predictions:"predictions",active:"active",selected:"selected"});var c=a(b)(d);e.after(c)}function j(){g.$parsers.push(n),g.$formatters.push(o),g.$render=p}function k(a){0!==d.predictions.length&&-1!==t(x,a.which)&&(a.preventDefault(),a.which===w.down?(d.active=(d.active+1)%d.predictions.length,d.$digest()):a.which===w.up?(d.active=(d.active?d.active:d.predictions.length)-1,d.$digest()):13===a.which||9===a.which?(d.forceSelection&&(d.active=-1===d.active?0:d.active),d.$apply(function(){d.selected=d.active,-1===d.selected&&q()})):27===a.which&&(a.stopPropagation(),q(),d.$digest()))}function l(){if(0!==d.predictions.length)d.forceSelection&&(d.selected=-1===d.selected?0:d.selected),d.$digest(),d.$apply(function(){-1===d.selected&&b(function(){q()},200)});else if(d.forceSelection){var a=function(){d.model=""},c=d.$root.$$phase;"$apply"==c||"$digest"==c?a():d.$apply(a)}}function m(){var a;a=d.predictions[d.selected],a&&(a.is_custom?(d.model=a.place,d.$emit("g-places-autocomplete:select",a.place)):z.getDetails({placeId:a.place_id},function(a,b){b==c.maps.places.PlacesServiceStatus.OK&&d.$apply(function(){d.model=a,d.$emit("g-places-autocomplete:select",a)})}),q())}function n(a){var b;return a&&_.isString(a)?(d.query=a,b=angular.extend({input:a},d.options),y.getPlacePredictions(b,function(a,b){d.$apply(function(){var e;q(),d.customPlaces&&(e=r(d.query),d.predictions.push.apply(d.predictions,e)),b==c.maps.places.PlacesServiceStatus.OK&&d.predictions.push.apply(d.predictions,a),d.predictions.length>5&&(d.predictions.length=5)})}),a):a}function o(a){var b="";return _.isString(a)?b=a:_.isObject(a)&&(b=a.formatted_address),b}function p(){return e.val(g.$viewValue)}function q(){d.active=-1,d.selected=-1,d.predictions.length=0}function r(a){var b,c,e,f=[];for(e=0;e<d.customPlaces.length;e++)b=d.customPlaces[e],c=s(a,b),c.matched_substrings.length>0&&f.push({is_custom:!0,custom_prediction_label:b.custom_prediction_label||"(Custom Non-Google Result)",description:b.formatted_address,place:b,matched_substrings:c.matched_substrings,terms:c.terms});return f}function s(a,b){var c,d,e,f=a+"",g=[],h=[];for(d=b.formatted_address.split(","),e=0;e<d.length;e++)c=d[e].trim(),f.length>0&&(c.length>=f.length?(u(c,f)&&h.push({length:f.length,offset:e}),f=""):u(f,c)?(h.push({length:c.length,offset:e}),f=f.replace(c,"").trim()):f=""),g.push({value:c,offset:b.formatted_address.indexOf(c)});return{matched_substrings:h,terms:g}}function t(a,b){var c,d;if(null==a)return-1;for(d=a.length,c=0;d>c;c++)if(a[c]===b)return c;return-1}function u(a,b){return 0===v(a).lastIndexOf(v(b),0)}function v(a){return null==a?"":a.toLowerCase()}var w={tab:9,enter:13,esc:27,up:38,down:40},x=_.values(w),y=new c.maps.places.AutocompleteService,z=new c.maps.places.PlacesService(e[0]);!function(){d.query="",d.predictions=[],d.input=e,d.options=d.options||{},i(),h(),j()}()}}}function c(a,b){var c=['<div class="pac-container" ng-style="{ width: position.width+\'px\' }"','ng-if="isOpen()" role="listbox" aria-hidden="{{ !isOpen() }}">','<div class="pac-item" g-places-autocomplete-prediction index="$index"','prediction="prediction" query="query" ng-repeat="prediction in predictions track by $index"','ng-class="{\'pac-item-selected\': isActive($index) }" ng-blur="selectPrediction($index)"','ng-mouseenter="selectActive($index)" ng-click="selectPrediction($index)"','role="option" id="{{prediction.id}}">',"</div>","</div>"];return{restrict:"A",scope:{input:"=",query:"=",predictions:"=",active:"=",selected:"="},template:c.join(""),link:function(c,d){function e(c){var d=c[0],e=d.getBoundingClientRect(),f=b[0].documentElement,g=b[0].body,h=a.pageYOffset||f.scrollTop||g.scrollTop,i=a.pageXOffset||f.scrollLeft||g.scrollLeft;return{width:e.width,height:e.height,top:e.top+e.height+h,left:e.left+i}}d.bind("mousedown",function(a){a.preventDefault()}),c.isOpen=function(){return c.predictions.length>0},c.isActive=function(a){return c.active===a},c.selectActive=function(a){c.active=a},c.selectPrediction=function(a){c.selected=a},c.$watch("predictions",function(){c.position=e(c.input)},!0)}}}function d(){var a=['<span class="pac-icon pac-icon-marker"></span>','<span class="pac-item-query" ng-bind-html="prediction | highlightMatched"></span>','<span ng-repeat="term in prediction.terms | unmatchedTermsOnly:prediction">',"{{term.value | trailingComma:!$last}}&nbsp;","</span>",'<span class="custom-prediction-label" ng-if="prediction.is_custom">',"&nbsp;{{prediction.custom_prediction_label}}","</span>"];return{restrict:"A",scope:{index:"=",prediction:"=",query:"="},template:a.join("")}}b.$inject=["$compile","$timeout","google"],a.directive("gPlacesAutocomplete",b),c.$inject=["$window","$document"],a.directive("gPlacesAutocompleteDrawer",c),a.directive("gPlacesAutocompletePrediction",d)}(angular.module("google.places.directives")),function(a){"use strict";function b(a){return function(b){var c,d="",e="";return b.matched_substrings.length>0&&b.terms.length>0&&(c=b.matched_substrings[0],d=b.terms[0].value.substr(c.offset,c.length),e=b.terms[0].value.substr(c.offset+c.length)),a.trustAsHtml('<span class="pac-matched">'+d+"</span>"+e)}}function c(){return function(a,b){var c,d,e=[];for(c=0;c<a.length;c++){d=a[c];var f=b.matched_substrings;f.length>0&&d.offset>f[0].length&&e.push(d)}return e}}function d(){return function(a,b){return b?a+",":a}}b.$inject=["$sce"],a.filter("highlightMatched",b),a.filter("unmatchedTermsOnly",c),a.filter("trailingComma",d)}(angular.module("google.places.filters"));